<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YSA OX í€´ì¦ˆ</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e1b4b 0%, #581c87 50%, #831843 100%);
            padding: 16px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .title {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin-bottom: 4px;
        }
        
        .title .green { color: #4ade80; }
        .title .gray { color: #d1d5db; }
        .title .red { color: #f87171; }
        .title .ysa { color: #fbbf24; font-size: 1.5rem; }
        
        .subtitle {
            color: #c4b5fd;
            font-size: 0.95rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            color: white;
            margin-bottom: 16px;
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-group label {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 6px;
            color: #e9d5ff;
        }
        
        .input-field {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 16px;
            outline: none;
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .input-field:focus {
            border-color: #a78bfa;
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.3);
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
            margin-bottom: 10px;
        }
        
        .btn:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #059669 100%);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            color: white;
        }
        
        .btn-orange {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
        }
        
        .btn-danger {
            background: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-small {
            padding: 10px 14px;
            font-size: 0.85rem;
            width: auto;
            margin-bottom: 0;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ìƒíƒœ í‘œì‹œ */
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-waiting {
            background: rgba(234, 179, 8, 0.3);
            color: #fde047;
        }
        
        .status-playing {
            background: rgba(34, 197, 94, 0.3);
            color: #4ade80;
        }
        
        .status-finished {
            background: rgba(239, 68, 68, 0.3);
            color: #f87171;
        }
        
        /* ëŒ€ê¸° í™”ë©´ */
        .waiting-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .waiting-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .waiting-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .waiting-message {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .player-info-box {
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.4);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .player-name-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #c4b5fd;
        }
        
        .current-score-display {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 8px;
        }
        
        /* í€´ì¦ˆ í™”ë©´ */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .question-number {
            background: rgba(168, 85, 247, 0.5);
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .score-display {
            background: rgba(234, 179, 8, 0.3);
            color: #fde047;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .timer-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            height: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .timer-fill {
            height: 100%;
            transition: width 1s linear;
            border-radius: 20px;
        }
        
        .timer-green { background: #22c55e; }
        .timer-yellow { background: #eab308; }
        .timer-red { background: #ef4444; }
        
        .timer-text {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 16px;
            font-family: 'Courier New', monospace;
        }
        
        .timer-warning {
            color: #f87171;
            animation: blink 0.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .question-text {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 30px;
            line-height: 1.7;
            text-align: center;
        }
        
        .answer-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .answer-btn {
            padding: 40px 20px;
            border: none;
            border-radius: 20px;
            font-size: 3rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.15s;
            color: white;
        }
        
        .answer-btn:active {
            transform: scale(0.95);
        }
        
        .answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-o {
            background: linear-gradient(135deg, #22c55e 0%, #059669 100%);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }
        
        .btn-x {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .btn-o.selected {
            box-shadow: 0 0 0 4px #4ade80, 0 6px 20px rgba(34, 197, 94, 0.6);
        }
        
        .btn-x.selected {
            box-shadow: 0 0 0 4px #f87171, 0 6px 20px rgba(239, 68, 68, 0.6);
        }
        
        .answer-submitted {
            text-align: center;
            padding: 30px;
        }
        
        .submitted-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }
        
        .submitted-text {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .your-answer {
            margin-top: 16px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: inline-block;
        }
        
        /* ê²°ê³¼ í™”ë©´ */
        .result-container {
            text-align: center;
        }
        
        .result-icon {
            font-size: 5rem;
            margin-bottom: 16px;
        }
        
        .result-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .result-correct { color: #4ade80; }
        .result-wrong { color: #f87171; }
        .result-timeout { color: #9ca3af; }
        
        .result-explanation {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
            line-height: 1.6;
        }
        
        .explanation-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }
        
        .points-earned {
            font-size: 2rem;
            font-weight: bold;
            color: #fbbf24;
            margin: 16px 0;
        }
        
        /* ë­í‚¹ */
        .ranking-container {
            margin-top: 20px;
        }
        
        .ranking-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ranking-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .ranking-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .ranking-item.rank-1 { background: rgba(234, 179, 8, 0.2); border: 1px solid rgba(234, 179, 8, 0.4); }
        .ranking-item.rank-2 { background: rgba(156, 163, 175, 0.2); border: 1px solid rgba(156, 163, 175, 0.4); }
        .ranking-item.rank-3 { background: rgba(217, 119, 6, 0.2); border: 1px solid rgba(217, 119, 6, 0.4); }
        .ranking-item.my-rank { background: rgba(168, 85, 247, 0.3); border: 2px solid #a855f7; }
        
        .rank-badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .rank-1 .rank-badge { background: #eab308; color: #422006; }
        .rank-2 .rank-badge { background: #9ca3af; color: #1f2937; }
        .rank-3 .rank-badge { background: #d97706; color: #422006; }
        
        .rank-info {
            flex: 1;
            min-width: 0;
        }
        
        .rank-name {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .rank-stats {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 2px;
        }
        
        .rank-score {
            font-weight: bold;
            color: #fbbf24;
            font-size: 1.1rem;
        }
        
        /* QR ì½”ë“œ */
        .qr-section {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .qr-code {
            background: white;
            padding: 16px;
            border-radius: 12px;
            display: inline-block;
            margin: 16px 0;
        }
        
        .qr-code img {
            display: block;
            width: 200px;
            height: 200px;
        }
        
        /* ê´€ë¦¬ì ì„¹ì…˜ */
        .admin-badge {
            background: rgba(249, 115, 22, 0.3);
            color: #fb923c;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .admin-panel {
            background: rgba(249, 115, 22, 0.1);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }
        
        .admin-panel h3 {
            color: #fb923c;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-status {
            background: rgba(0, 0, 0, 0.2);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .admin-status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .admin-status-item:last-child {
            margin-bottom: 0;
        }
        
        .admin-status-label {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .admin-status-value {
            font-weight: bold;
        }
        
        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 16px 0;
        }
        
        .participant-count {
            background: rgba(34, 197, 94, 0.3);
            color: #4ade80;
            padding: 12px 16px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 16px;
            font-weight: 500;
        }
        
        .connection-status {
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 12px;
        }
        
        .status-connected {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        
        .status-disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        
        /* ìµœì¢… ê²°ê³¼ */
        .final-result {
            text-align: center;
            padding: 20px 0;
        }
        
        .trophy-icon {
            font-size: 6rem;
            margin-bottom: 16px;
        }
        
        .final-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .final-subtitle {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 24px;
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .final-stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
        }
        
        .final-stat-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
        }
        
        .final-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .stat-gold { color: #fbbf24; }
        .stat-purple { color: #c084fc; }
        .stat-green { color: #4ade80; }
        .stat-blue { color: #60a5fa; }
        
        .slider-container {
            margin-bottom: 16px;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            margin-top: 10px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #a78bfa;
            cursor: pointer;
        }
        
        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.85rem;
            margin-top: 24px;
        }
        
        @media (max-width: 400px) {
            .title { font-size: 1.7rem; }
            .question-text { font-size: 1.1rem; }
            .answer-btn { padding: 30px 15px; font-size: 2.5rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1 class="title">
                <span class="ysa">YSA</span>
                <span class="green">O</span><span class="gray">/</span><span class="red">X</span>
                í€´ì¦ˆ
                <span id="admin-badge" class="admin-badge hidden">ê´€ë¦¬ì</span>
            </h1>
            <p class="subtitle">Young Scientist Award 2024</p>
        </div>
        
        <!-- ========== ì…ì¥ í™”ë©´ ========== -->
        <div id="entry-screen" class="card">
            <div id="connection-status" class="connection-status status-disconnected">
                ğŸ”„ ì„œë²„ ì—°ê²° ì¤‘...
            </div>
            
            <!-- QR ì½”ë“œ (í° í™”ë©´ìš©) -->
            <div class="qr-section" id="qr-section">
                <p style="margin-bottom: 12px; font-weight: 500;">ğŸ“± QR ì½”ë“œë¡œ ì°¸ì—¬í•˜ê¸°</p>
                <div class="qr-code">
                    <img id="qr-image" src="" alt="QR Code">
                </div>
                <p style="font-size: 0.85rem; color: rgba(255,255,255,0.6);">ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ìŠ¤ìº”í•˜ì„¸ìš”!</p>
            </div>
            
            <div class="participant-count">
                ğŸ® í˜„ì¬ ì°¸ì—¬ì: <span id="participant-count">0</span>ëª…
            </div>
            
            <div class="input-group">
                <label>ì°¸ê°€ì ì´ë¦„ (í¬ìŠ¤í„° ë²ˆí˜¸)</label>
                <input type="text" id="player-name" class="input-field" placeholder="ì˜ˆ: 15ë²ˆ í™ê¸¸ë™" maxlength="30" autocomplete="off">
            </div>
            
            <button class="btn btn-primary" onclick="joinQuiz()">
                ğŸ¯ í€´ì¦ˆ ì°¸ì—¬í•˜ê¸°
            </button>
            
            <button class="btn btn-secondary" onclick="showRanking()">
                ğŸ† ì „ì²´ ë­í‚¹ ë³´ê¸°
            </button>
            
            <button id="admin-login-btn" class="btn btn-orange" onclick="showAdminLogin()">
                ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸
            </button>
            
            <!-- ê´€ë¦¬ì íŒ¨ë„ -->
            <div id="admin-panel" class="admin-panel hidden">
                <h3>âš™ï¸ ê´€ë¦¬ì ì»¨íŠ¸ë¡¤</h3>
                
                <div class="admin-status">
                    <div class="admin-status-item">
                        <span class="admin-status-label">í˜„ì¬ ìƒíƒœ</span>
                        <span class="admin-status-value" id="admin-game-status">ëŒ€ê¸° ì¤‘</span>
                    </div>
                    <div class="admin-status-item">
                        <span class="admin-status-label">í˜„ì¬ ë¬¸ì œ</span>
                        <span class="admin-status-value" id="admin-current-question">-</span>
                    </div>
                    <div class="admin-status-item">
                        <span class="admin-status-label">ì°¸ì—¬ì ìˆ˜</span>
                        <span class="admin-status-value" id="admin-participant-count">0ëª…</span>
                    </div>
                    <div class="admin-status-item">
                        <span class="admin-status-label">ë‹µë³€ ì œì¶œ</span>
                        <span class="admin-status-value" id="admin-answer-count">0ëª…</span>
                    </div>
                </div>
                
                <div class="slider-container">
                    <label>ë¬¸ì œë‹¹ ì œí•œì‹œê°„: <span id="time-display">15</span>ì´ˆ</label>
                    <input type="range" id="time-slider" class="slider" min="5" max="60" value="15">
                </div>
                
                <button id="btn-start-question" class="btn btn-primary" onclick="adminStartQuestion()">
                    â–¶ï¸ ë‹¤ìŒ ë¬¸ì œ ì‹œì‘
                </button>
                
                <button id="btn-show-answer" class="btn btn-blue hidden" onclick="adminShowAnswer()">
                    âœ… ì •ë‹µ ê³µê°œ & ë­í‚¹ í‘œì‹œ
                </button>
                
                <button id="btn-end-game" class="btn btn-danger hidden" onclick="adminEndGame()">
                    ğŸ í€´ì¦ˆ ì¢…ë£Œ (ìµœì¢… ê²°ê³¼)
                </button>
                
                <div class="divider"></div>
                
                <button class="btn btn-purple" onclick="showQuizEditor()">
                    âœï¸ í€´ì¦ˆ ë¬¸ì œ í¸ì§‘
                </button>
                
                <button class="btn btn-danger" onclick="resetAllData()">
                    ğŸ—‘ï¸ ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
                </button>
                
                <button class="btn btn-secondary" onclick="logoutAdmin()">
                    ğŸšª ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
        
        <!-- ========== ê´€ë¦¬ì ë¡œê·¸ì¸ ========== -->
        <div id="admin-login-screen" class="card hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            
            <div class="input-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="admin-password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            </div>
            
            <button class="btn btn-primary" onclick="loginAdmin()">ë¡œê·¸ì¸</button>
            <button class="btn btn-secondary" onclick="showEntry()">ëŒì•„ê°€ê¸°</button>
        </div>
        
        <!-- ========== í€´ì¦ˆ í¸ì§‘ ========== -->
        <div id="quiz-editor-screen" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2>âœï¸ í€´ì¦ˆ í¸ì§‘</h2>
                <button class="btn btn-secondary btn-small" onclick="showEntry()">ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div id="quiz-editor-list"></div>
            
            <button class="btn btn-secondary" onclick="addNewQuiz()" style="border: 2px dashed rgba(255,255,255,0.3);">
                + ìƒˆ ë¬¸ì œ ì¶”ê°€
            </button>
            
            <div class="divider"></div>
            
            <button class="btn btn-primary" onclick="saveQuizzes()">
                ğŸ’¾ ì €ì¥í•˜ê¸°
            </button>
        </div>
        
        <!-- ========== ì‚¬ìš©ì ëŒ€ê¸° í™”ë©´ ========== -->
        <div id="waiting-screen" class="card hidden">
            <div class="waiting-container">
                <div class="waiting-icon">â³</div>
                <h2 class="waiting-title">ì ì‹œ ëŒ€ê¸°í•´ì£¼ì„¸ìš”</h2>
                <p class="waiting-message">
                    ê´€ë¦¬ìê°€ ë‹¤ìŒ ë¬¸ì œë¥¼ ì‹œì‘í•˜ë©´<br>
                    ìë™ìœ¼ë¡œ í™”ë©´ì´ ì „í™˜ë©ë‹ˆë‹¤.
                </p>
                
                <div id="waiting-status" class="status-badge status-waiting">
                    ëŒ€ê¸° ì¤‘
                </div>
                
                <div class="player-info-box">
                    <div class="player-name-display">ğŸ‘¤ <span id="waiting-player-name"></span></div>
                    <div class="current-score-display">í˜„ì¬ ì ìˆ˜: <span id="waiting-current-score">0</span>ì </div>
                </div>
            </div>
        </div>
        
        <!-- ========== í€´ì¦ˆ ì§„í–‰ í™”ë©´ ========== -->
        <div id="quiz-screen" class="card hidden">
            <div class="quiz-header">
                <span class="question-number" id="question-number">Q1</span>
                <span class="score-display" id="quiz-score">0ì </span>
            </div>
            
            <div class="timer-bar">
                <div class="timer-fill timer-green" id="timer-fill"></div>
            </div>
            
            <div class="timer-text" id="timer-text">â±ï¸ 15ì´ˆ</div>
            
            <p class="question-text" id="question-text"></p>
            
            <div id="answer-section" class="answer-buttons">
                <button class="answer-btn btn-o" id="btn-answer-o" onclick="submitAnswer(true)">
                    â­•<br><span style="font-size: 1rem;">O</span>
                </button>
                <button class="answer-btn btn-x" id="btn-answer-x" onclick="submitAnswer(false)">
                    âŒ<br><span style="font-size: 1rem;">X</span>
                </button>
            </div>
            
            <div id="submitted-section" class="answer-submitted hidden">
                <div class="submitted-icon">âœ…</div>
                <p class="submitted-text">ë‹µë³€ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                <div class="your-answer">
                    ë‚´ ë‹µë³€: <strong id="my-answer-display"></strong>
                </div>
                <p style="margin-top: 16px; color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                    ì •ë‹µ ê³µê°œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
                </p>
            </div>
        </div>
        
        <!-- ========== ê²°ê³¼ í™”ë©´ ========== -->
        <div id="result-screen" class="card hidden">
            <div class="result-container">
                <div class="result-icon" id="result-icon">ğŸ‰</div>
                <h2 class="result-title" id="result-title">ì •ë‹µ!</h2>
                <p id="result-answer-text">ì •ë‹µ: O</p>
                
                <div class="points-earned" id="points-earned">+250ì </div>
                
                <div class="result-explanation">
                    <p class="explanation-label">ğŸ’¡ í•´ì„¤</p>
                    <p id="result-explanation"></p>
                </div>
                
                <div class="ranking-container">
                    <div class="ranking-title">ğŸ† í˜„ì¬ ìˆœìœ„ (ìƒìœ„ 10ëª…)</div>
                    <div class="ranking-list" id="result-ranking-list"></div>
                </div>
                
                <p style="margin-top: 20px; color: rgba(255,255,255,0.6); font-size: 0.9rem;">
                    ë‹¤ìŒ ë¬¸ì œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
                </p>
            </div>
        </div>
        
        <!-- ========== ìµœì¢… ê²°ê³¼ í™”ë©´ ========== -->
        <div id="final-screen" class="card hidden">
            <div class="final-result">
                <div class="trophy-icon">ğŸ†</div>
                <h2 class="final-title">í€´ì¦ˆ ì¢…ë£Œ!</h2>
                <p class="final-subtitle">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</p>
                
                <div class="final-stats">
                    <div class="final-stat-box">
                        <p class="final-stat-label">ìµœì¢… ì ìˆ˜</p>
                        <p class="final-stat-value stat-gold" id="final-score">0</p>
                    </div>
                    <div class="final-stat-box">
                        <p class="final-stat-label">ìµœì¢… ìˆœìœ„</p>
                        <p class="final-stat-value stat-purple" id="final-rank">#1</p>
                    </div>
                    <div class="final-stat-box">
                        <p class="final-stat-label">ì •ë‹µ ìˆ˜</p>
                        <p class="final-stat-value stat-green" id="final-correct">0/0</p>
                    </div>
                    <div class="final-stat-box">
                        <p class="final-stat-label">í‰ê·  ì‘ë‹µì‹œê°„</p>
                        <p class="final-stat-value stat-blue" id="final-avg-time">0ì´ˆ</p>
                    </div>
                </div>
                
                <div class="ranking-container">
                    <div class="ranking-title">ğŸ† ìµœì¢… ìˆœìœ„</div>
                    <div class="ranking-list" id="final-ranking-list"></div>
                </div>
            </div>
        </div>
        
        <!-- ========== ì „ì²´ ë­í‚¹ í™”ë©´ ========== -->
        <div id="ranking-screen" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2>ğŸ† ì „ì²´ ë­í‚¹</h2>
                <button class="btn btn-secondary btn-small" onclick="showEntry()">ëŒì•„ê°€ê¸°</button>
            </div>
            
            <div class="ranking-list" id="full-ranking-list" style="max-height: 500px;"></div>
        </div>
        
        <p class="footer">YSA 2024 OX í€´ì¦ˆ | Powered by Firebase</p>
    </div>
    
    <script>
        // ========================================
        // Firebase ì„¤ì •
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyCuYhaoYzSR6OV7AsWKl6SygIbYGVZUltI",
            authDomain: "th-ysa.firebaseapp.com",
            databaseURL: "https://th-ysa-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "th-ysa",
            storageBucket: "th-ysa.firebasestorage.app",
            messagingSenderId: "832534032448",
            appId: "1:832534032448:web:917901530f5d892ac92fa5"
        };
        
        const ADMIN_PASSWORD = "hanzo9752";
        
        // ========================================
        // ê¸°ë³¸ í€´ì¦ˆ ë°ì´í„°
        // ========================================
        let quizzes = [
            { id: 1, question: "Young Scientist Awardsì— ì´ 63ê°œì˜ í¬ìŠ¤í„°ê°€ ìˆë‹¤.", answer: true, explanation: "ê¸°ì´ˆììœ¨ì—°êµ¬ 37ê°œ, ì‹¬í™”ììœ¨ì—°êµ¬ 26ê°œ, ì´ 63ê°œì…ë‹ˆë‹¤." },
            { id: 2, question: "Young Scientist Awardsì˜ ì§„í–‰ì„ ë§¡ì€ ì„ ìƒë‹˜ì˜ ê³¼ëª©ì€ ë¬¼ë¦¬ì´ë‹¤.", answer: true, explanation: "ì§„í–‰ì„ ë§¡ìœ¼ì‹  ì„ ìƒë‹˜ì€ ë…¸ì¬ì¤€ ë¬¼ë¦¬ ì„ ìƒë‹˜ì´ì‹­ë‹ˆë‹¤." },
            { id: 3, question: "ì œëª©ì—ì„œ '~íƒêµ¬'ë³´ë‹¤ '~ì—°êµ¬'ë¡œ ëë‚˜ëŠ” í¬ìŠ¤í„°ì˜ ê°œìˆ˜ê°€ ë” ë§ë‹¤.", answer: true, explanation: "'~íƒêµ¬'ë¡œ ëë‚˜ëŠ” í¬ìŠ¤í„°ëŠ” 5ê°œ, '~ì—°êµ¬'ë¡œ ëë‚˜ëŠ” í¬ìŠ¤í„°ëŠ” ë” ë§ìŠµë‹ˆë‹¤." },
            { id: 4, question: "ì œëª©ì—ì„œ '~ì—°êµ¬'ë¡œ ëë‚˜ëŠ” í¬ìŠ¤í„°ì˜ ì´ ê°œìˆ˜ëŠ” 20ê°œì´ë‹¤.", answer: false, explanation: "ê¸°ì´ˆ ììœ¨ì—°êµ¬ì—ì„œ 11ê°œ, ì‹¬í™” ììœ¨ì—°êµ¬ì—ì„œ 6ê°œ, ì´ 19ê°œì…ë‹ˆë‹¤." },
            { id: 5, question: "[ê¸°ì´ˆ_ìˆ˜í•™] ìˆ«ì ì•¼êµ¬ ê²Œì„ì— ëŒ€í•´ ì—°êµ¬í•œ íŒ€ì˜ ì§€ë„ì„ ìƒë‹˜ì€ ì „ê³„ì • ì„ ìƒë‹˜ì´ë‹¤.", answer: false, explanation: "[ìˆ˜-08] ìˆ«ì ì•¼êµ¬ì˜ ìµœì í™” ì „ëµì— ëŒ€í•œ ì—°êµ¬ëŠ” ì „ê²½ì•„ ì„ ìƒë‹˜ê»˜ì„œ ì§€ë„í•˜ì…¨ìŠµë‹ˆë‹¤." },
            { id: 6, question: "[ì‹¬í™”_ì •ë³´ê³¼í•™] AIê°€ ì‘ê°€ì˜ ê·¸ë¦¼ì²´ë¥¼ ë³µì œí•˜ì§€ ëª»í•˜ë„ë¡ ì´ë¯¸ì§€ì— ì‚¬ëŒì´ ëª» ë³´ëŠ” 'ì ëŒ€ì  ì„­ë™'ì„ ì‚½ì…í•˜ëŠ” ê¸°ìˆ ì„ ê°œë°œí•œ íŒ€ì˜ í•™ìƒìˆ˜ëŠ” 3ëª…ì´ë©°, ì„¸ ëª… ëª¨ë‘ ì´ë¦„ì—ì„œ ê²¹ì¹˜ëŠ” ê¸€ìê°€ ì—†ë‹¤.", answer: false, explanation: "[ì •-03] Diffusion Modelì—ì„œ ê·¸ë¦¼ì²´ ë³µì œ ë°©ì§€ë¥¼ ìœ„í•œ ì´ë¯¸ì§€ ë³´í˜¸ ê¸°ìˆ  ì—°êµ¬ì˜ íŒ€ì›ìˆ˜ëŠ” 3ëª…ì´ë©°, ì´ì •ìš°, ì •ìš°ì„, ê¹€ê±´ìš°ë¡œ 'ìš°'ë¼ëŠ” ê¸€ìê°€ ê²¹ì¹œë‹¤." },
            { id: 7, question: "ì•„ë‘ì´ë…¸ì™€ LEDë¥¼ ì¨ì„œ í›¨ì”¬ ì €ë ´í•œ ì¸¡ì • ì¥ì¹˜ë¥¼ ë§Œë“œëŠ” ì—°êµ¬ì— ë”¥ëŸ¬ë‹ ê¸°ìˆ ì„ ì ìš©í–ˆë‹¤.", answer: false, explanation: "[í™”-05] 'ë¨¸ì‹ ëŸ¬ë‹ì„ í™œìš©í•œ ì €ë¹„ìš© LED ë¶„ê´‘ê´‘ë„ê³„ ì œì‘ ë° ì„±ëŠ¥ í–¥ìƒ ì—°êµ¬'ì—ì„œëŠ” ë¨¸ì‹ ëŸ¬ë‹ ê¸°ìˆ ì„ ì´ìš©í–ˆë‹¤. ë”¥ëŸ¬ë‹ ê¸°ìˆ ì„ ì´ìš©í•œ ì—°êµ¬ëŠ” [ì •-06] 'ë”¥ëŸ¬ë‹ ê¸°ë°˜ì˜ ë³µí•© í‘œí˜„ ì†ê¸€ì”¨ì˜ ì¸ì‹ ë° ìš”ì•½'ì´ë‹¤." },
            { id: 8, question: "Young Scientist Awardsì—ì„œ ìš°ìˆ˜í•œ ì„±ì ì„ ë°›ì€ íŒ€ë“¤ ì¤‘ ì‹¬í™” ììœ¨ì—°êµ¬ë§Œ ì˜ì¬í•™êµ ê³µë™ ë°œí‘œíšŒì— ì°¸ê°€ ìê²©ì´ ì£¼ì–´ì§„ë‹¤.", answer:  true, explanation: "ê¸°ì´ˆ ììœ¨ì—°êµ¬ íŒ€ì´ ì•„ë‹Œ ì‹¬í™” ììœ¨ì—°êµ¬ íŒ€ë“¤ë§Œ ìê²©ì´ ì£¼ì–´ì§‘ë‹ˆë‹¤. ì˜ì¬í•™êµ ê³µë™ ë°œí‘œíšŒëŠ” 2026ë…„ 1ì›” 3ì¼ì— ì§„í–‰í•©ë‹ˆë‹¤." },
        ];
        // ========================================
        // ìƒíƒœ ë³€ìˆ˜
        // ========================================
        let database = null;
        let isConnected = false;
        let isAdmin = false;
        let playerName = '';
        let playerId = null;
        let timeLimit = 15;
        
        // ê²Œì„ ìƒíƒœ (Firebaseì—ì„œ ë™ê¸°í™”)
        let gameState = {
            status: 'waiting',      // waiting, playing, showingAnswer, finished
            currentQuestion: -1,    // -1 = ì‹œì‘ ì „
            timeLimit: 15,
            questionStartTime: null
        };
        
        // ë‚´ ê²Œì„ ë°ì´í„°
        let myData = {
            score: 0,
            correctCount: 0,
            totalTime: 0,
            answeredQuestions: []
        };
        
        let currentAnswer = null;
        let answerSubmitTime = null;
        let timerInterval = null;
        let remainingTime = 0;
        
        // ========================================
        // Firebase ì´ˆê¸°í™”
        // ========================================
        function initFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                
                // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
                database.ref('.info/connected').on('value', (snap) => {
                    isConnected = snap.val() === true;
                    updateConnectionStatus(isConnected);
                });
                
                // ê²Œì„ ìƒíƒœ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
                database.ref('gameState').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const prevState = { ...gameState };
                        gameState = data;
                        handleGameStateChange(prevState, gameState);
                    }
                });
                
                // í€´ì¦ˆ ë°ì´í„° ë¡œë“œ
                database.ref('quizzes').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        quizzes = Object.values(data);
                    }
                });
                
                // ì°¸ì—¬ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
                database.ref('players').on('value', (snapshot) => {
                    const data = snapshot.val();
                    const count = data ? Object.keys(data).length : 0;
                    document.getElementById('participant-count').textContent = count;
                    document.getElementById('admin-participant-count').textContent = count + 'ëª…';
                });
                
                // ë‹µë³€ ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ììš©)
                database.ref('answers').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data && gameState.currentQuestion >= 0) {
                        const qKey = 'q' + gameState.currentQuestion;
                        const answers = data[qKey] || {};
                        const count = Object.keys(answers).length;
                        document.getElementById('admin-answer-count').textContent = count + 'ëª…';
                    }
                });
                
                // QR ì½”ë“œ ìƒì„±
                generateQR();
                
            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                updateConnectionStatus(false);
            }
        }
        
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connection-status');
            if (connected) {
                statusEl.className = 'connection-status status-connected';
                statusEl.textContent = 'âœ… ì„œë²„ ì—°ê²°ë¨';
            } else {
                statusEl.className = 'connection-status status-disconnected';
                statusEl.textContent = 'âš ï¸ ì—°ê²° ëŠê¹€';
            }
        }
        
        // ========================================
        // ê²Œì„ ìƒíƒœ ë³€í™” ì²˜ë¦¬
        // ========================================
        function handleGameStateChange(prevState, newState) {
            // ê´€ë¦¬ì íŒ¨ë„ ì—…ë°ì´íŠ¸
            updateAdminPanel();
            
            // í”Œë ˆì´ì–´ê°€ ì•„ì§ ì°¸ì—¬í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¬´ì‹œ
            if (!playerId) return;
            
            console.log('State change:', prevState.status, '->', newState.status, 'Q:', newState.currentQuestion);
            
            // ìƒíƒœë³„ í™”ë©´ ì „í™˜
            if (newState.status === 'waiting') {
                showScreen('waiting-screen');
                updateWaitingScreen();
            } else if (newState.status === 'playing') {
                // ì´ë¯¸ ì´ ë¬¸ì œì— ë‹µí–ˆëŠ”ì§€ í™•ì¸
                if (myData.answeredQuestions.includes(newState.currentQuestion)) {
                    showScreen('quiz-screen');
                    showSubmittedState();
                } else {
                    showScreen('quiz-screen');
                    startQuizQuestion();
                }
            } else if (newState.status === 'showingAnswer') {
                showScreen('result-screen');
                showQuestionResult();
            } else if (newState.status === 'finished') {
                showScreen('final-screen');
                showFinalResult();
            }
        }
        
        function updateAdminPanel() {
            const statusText = {
                'waiting': 'â³ ëŒ€ê¸° ì¤‘',
                'playing': 'ğŸ® ë¬¸ì œ ì§„í–‰ ì¤‘',
                'showingAnswer': 'ğŸ“Š ì •ë‹µ ê³µê°œ ì¤‘',
                'finished': 'ğŸ ì¢…ë£Œë¨'
            };
            
            document.getElementById('admin-game-status').textContent = statusText[gameState.status] || 'ì•Œ ìˆ˜ ì—†ìŒ';
            document.getElementById('admin-current-question').textContent = 
                gameState.currentQuestion >= 0 ? `${gameState.currentQuestion + 1} / ${quizzes.length}` : '-';
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            const btnStart = document.getElementById('btn-start-question');
            const btnAnswer = document.getElementById('btn-show-answer');
            const btnEnd = document.getElementById('btn-end-game');
            
            if (gameState.status === 'waiting') {
                btnStart.classList.remove('hidden');
                btnAnswer.classList.add('hidden');
                if (gameState.currentQuestion >= quizzes.length - 1 && gameState.currentQuestion >= 0) {
                    btnStart.classList.add('hidden');
                    btnEnd.classList.remove('hidden');
                } else {
                    btnEnd.classList.add('hidden');
                }
            } else if (gameState.status === 'playing') {
                btnStart.classList.add('hidden');
                btnAnswer.classList.remove('hidden');
                btnEnd.classList.add('hidden');
            } else if (gameState.status === 'showingAnswer') {
                btnStart.classList.remove('hidden');
                btnAnswer.classList.add('hidden');
                if (gameState.currentQuestion >= quizzes.length - 1) {
                    btnStart.classList.add('hidden');
                    btnEnd.classList.remove('hidden');
                } else {
                    btnEnd.classList.add('hidden');
                }
            } else if (gameState.status === 'finished') {
                btnStart.classList.add('hidden');
                btnAnswer.classList.add('hidden');
                btnEnd.classList.add('hidden');
            }
        }
        
        // ========================================
        // í™”ë©´ ì „í™˜
        // ========================================
        function showScreen(screenId) {
            const screens = ['entry-screen', 'admin-login-screen', 'quiz-editor-screen', 
                           'waiting-screen', 'quiz-screen', 'result-screen', 'final-screen', 'ranking-screen'];
            screens.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        function showEntry() {
            showScreen('entry-screen');
        }
        
        // ========================================
        // ì‚¬ìš©ì ì°¸ì—¬
        // ========================================
        async function joinQuiz() {
            playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            // ê²Œì„ì´ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (gameState.status === 'finished') {
                alert('í€´ì¦ˆê°€ ì´ë¯¸ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í”Œë ˆì´ì–´ ID ìƒì„± ë° ë“±ë¡
            playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            try {
                await database.ref('players/' + playerId).set({
                    name: playerName,
                    joinedAt: Date.now(),
                    score: 0
                });
                
                // ë‚´ ë°ì´í„° ë¡œë“œ
                loadMyData();
                
                // í˜„ì¬ ê²Œì„ ìƒíƒœì— ë”°ë¼ í™”ë©´ ì „í™˜
                if (gameState.status === 'waiting') {
                    showScreen('waiting-screen');
                    updateWaitingScreen();
                } else if (gameState.status === 'playing') {
                    showScreen('quiz-screen');
                    startQuizQuestion();
                } else if (gameState.status === 'showingAnswer') {
                    showScreen('result-screen');
                    showQuestionResult();
                } else if (gameState.status === 'finished') {
                    showScreen('final-screen');
                    showFinalResult();
                }
                
            } catch (error) {
                console.error('ì°¸ì—¬ ì˜¤ë¥˜:', error);
                alert('ì°¸ì—¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function loadMyData() {
            if (!playerId) return;
            
            database.ref('players/' + playerId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    myData.score = data.score || 0;
                    myData.correctCount = data.correctCount || 0;
                    myData.totalTime = data.totalTime || 0;
                    myData.answeredQuestions = data.answeredQuestions || [];
                    
                    // UI ì—…ë°ì´íŠ¸
                    document.getElementById('waiting-current-score').textContent = myData.score;
                    document.getElementById('quiz-score').textContent = myData.score + 'ì ';
                }
            });
        }
        
        // ========================================
        // ëŒ€ê¸° í™”ë©´
        // ========================================
        function updateWaitingScreen() {
            document.getElementById('waiting-player-name').textContent = playerName;
            document.getElementById('waiting-current-score').textContent = myData.score;
            
            const statusEl = document.getElementById('waiting-status');
            if (gameState.currentQuestion < 0) {
                statusEl.textContent = 'í€´ì¦ˆ ì‹œì‘ ëŒ€ê¸° ì¤‘';
            } else {
                statusEl.textContent = `${gameState.currentQuestion + 1}ë²ˆ ë¬¸ì œ ì™„ë£Œ - ë‹¤ìŒ ë¬¸ì œ ëŒ€ê¸° ì¤‘`;
            }
        }
        
        // ========================================
        // í€´ì¦ˆ ì§„í–‰
        // ========================================
        function startQuizQuestion() {
            if (gameState.currentQuestion < 0 || gameState.currentQuestion >= quizzes.length) return;
            
            const quiz = quizzes[gameState.currentQuestion];
            currentAnswer = null;
            answerSubmitTime = null;
            
            document.getElementById('question-number').textContent = `Q${gameState.currentQuestion + 1}`;
            document.getElementById('quiz-score').textContent = myData.score + 'ì ';
            document.getElementById('question-text').textContent = quiz.question;
            
            // ë‹µë³€ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('answer-section').classList.remove('hidden');
            document.getElementById('submitted-section').classList.add('hidden');
            document.getElementById('btn-answer-o').disabled = false;
            document.getElementById('btn-answer-x').disabled = false;
            document.getElementById('btn-answer-o').classList.remove('selected');
            document.getElementById('btn-answer-x').classList.remove('selected');
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            timeLimit = gameState.timeLimit || 15;
            remainingTime = timeLimit;
            
            // ì„œë²„ ì‹œì‘ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë‚¨ì€ ì‹œê°„ ê³„ì‚°
            if (gameState.questionStartTime) {
                const elapsed = (Date.now() - gameState.questionStartTime) / 1000;
                remainingTime = Math.max(0, timeLimit - elapsed);
            }
            
            updateTimerDisplay();
            startTimer();
        }
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                remainingTime = Math.max(0, remainingTime - 1);
                updateTimerDisplay();
                
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    if (currentAnswer === null) {
                        // ì‹œê°„ ì´ˆê³¼ - ìë™ ì œì¶œ
                        autoSubmitTimeout();
                    }
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const timerText = document.getElementById('timer-text');
            const timerFill = document.getElementById('timer-fill');
            
            timerText.textContent = `â±ï¸ ${Math.ceil(remainingTime)}ì´ˆ`;
            timerFill.style.width = `${(remainingTime / timeLimit) * 100}%`;
            
            timerFill.className = 'timer-fill';
            if (remainingTime > timeLimit * 0.6) {
                timerFill.classList.add('timer-green');
            } else if (remainingTime > timeLimit * 0.3) {
                timerFill.classList.add('timer-yellow');
            } else {
                timerFill.classList.add('timer-red');
            }
            
            if (remainingTime <= 5) {
                timerText.classList.add('timer-warning');
            } else {
                timerText.classList.remove('timer-warning');
            }
        }
        
        async function submitAnswer(answer) {
            if (currentAnswer !== null) return; // ì´ë¯¸ ì œì¶œí•¨
            
            currentAnswer = answer;
            answerSubmitTime = Date.now();
            
            clearInterval(timerInterval);
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('btn-answer-o').disabled = true;
            document.getElementById('btn-answer-x').disabled = true;
            
            if (answer === true) {
                document.getElementById('btn-answer-o').classList.add('selected');
            } else {
                document.getElementById('btn-answer-x').classList.add('selected');
            }
            
            // ì‘ë‹µ ì‹œê°„ ê³„ì‚°
            const responseTime = gameState.questionStartTime 
                ? (answerSubmitTime - gameState.questionStartTime) / 1000 
                : timeLimit;
            
            // Firebaseì— ë‹µë³€ ì €ì¥
            try {
                await database.ref(`answers/q${gameState.currentQuestion}/${playerId}`).set({
                    answer: answer,
                    responseTime: responseTime,
                    submittedAt: answerSubmitTime
                });
                
                // ë‹µë³€ ì™„ë£Œ í‘œì‹œ
                showSubmittedState();
                
            } catch (error) {
                console.error('ë‹µë³€ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }
        
        function autoSubmitTimeout() {
            currentAnswer = null;
            answerSubmitTime = Date.now();
            
            // Firebaseì— ì‹œê°„ì´ˆê³¼ ì €ì¥
            database.ref(`answers/q${gameState.currentQuestion}/${playerId}`).set({
                answer: null,
                responseTime: timeLimit,
                submittedAt: answerSubmitTime,
                timeout: true
            });
            
            showSubmittedState();
        }
        
        function showSubmittedState() {
            document.getElementById('answer-section').classList.add('hidden');
            document.getElementById('submitted-section').classList.remove('hidden');
            
            if (currentAnswer === true) {
                document.getElementById('my-answer-display').textContent = 'O';
            } else if (currentAnswer === false) {
                document.getElementById('my-answer-display').textContent = 'X';
            } else {
                document.getElementById('my-answer-display').textContent = 'ì‹œê°„ ì´ˆê³¼';
            }
        }
        
        // ========================================
        // ê²°ê³¼ í™”ë©´
        // ========================================
        async function showQuestionResult() {
            if (gameState.currentQuestion < 0 || gameState.currentQuestion >= quizzes.length) return;
            
            clearInterval(timerInterval);
            
            const quiz = quizzes[gameState.currentQuestion];
            const correctAnswer = quiz.answer;
            
            // ë‚´ ë‹µë³€ ê°€ì ¸ì˜¤ê¸°
            const answerSnapshot = await database.ref(`answers/q${gameState.currentQuestion}/${playerId}`).once('value');
            const myAnswer = answerSnapshot.val();
            
            const isCorrect = myAnswer && myAnswer.answer === correctAnswer;
            const isTimeout = myAnswer && myAnswer.timeout;
            
            // ê²°ê³¼ UI ì—…ë°ì´íŠ¸
            const resultIcon = document.getElementById('result-icon');
            const resultTitle = document.getElementById('result-title');
            
            if (isTimeout || !myAnswer) {
                resultIcon.textContent = 'â±ï¸';
                resultTitle.textContent = 'ì‹œê°„ ì´ˆê³¼!';
                resultTitle.className = 'result-title result-timeout';
                document.getElementById('points-earned').textContent = '+0ì ';
            } else if (isCorrect) {
                resultIcon.textContent = 'ğŸ‰';
                resultTitle.textContent = 'ì •ë‹µ!';
                resultTitle.className = 'result-title result-correct';
                
                // ì ìˆ˜ ê³„ì‚°
                const responseTime = myAnswer.responseTime || timeLimit;
                const timeBonus = Math.max(0, Math.floor((timeLimit - responseTime) * 10));
                const points = 100 + timeBonus;
                document.getElementById('points-earned').textContent = `+${points}ì `;
            } else {
                resultIcon.textContent = 'ğŸ˜¢';
                resultTitle.textContent = 'ì˜¤ë‹µ!';
                resultTitle.className = 'result-title result-wrong';
                document.getElementById('points-earned').textContent = '+0ì ';
            }
            
            document.getElementById('result-answer-text').textContent = `ì •ë‹µ: ${correctAnswer ? 'O' : 'X'}`;
            document.getElementById('result-explanation').textContent = quiz.explanation;
            
            // ë­í‚¹ í‘œì‹œ
            await renderCurrentRanking('result-ranking-list');
            
            // ë‹µë³€í•œ ë¬¸ì œ ëª©ë¡ ì—…ë°ì´íŠ¸
            if (!myData.answeredQuestions.includes(gameState.currentQuestion)) {
                myData.answeredQuestions.push(gameState.currentQuestion);
                await database.ref(`players/${playerId}/answeredQuestions`).set(myData.answeredQuestions);
            }
        }
        
        // ========================================
        // ë­í‚¹ ê³„ì‚° ë° í‘œì‹œ
        // ========================================
        async function renderCurrentRanking(containerId) {
            const playersSnapshot = await database.ref('players').once('value');
            const players = playersSnapshot.val() || {};
            
            // ì ìˆ˜ìˆœ ì •ë ¬
            const ranking = Object.entries(players)
                .map(([id, data]) => ({ id, ...data }))
                .sort((a, b) => (b.score || 0) - (a.score || 0));
            
            const container = document.getElementById(containerId);
            
            if (ranking.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.6);">ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            const topRanking = ranking.slice(0, 10);
            
            container.innerHTML = topRanking.map((player, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                const isMe = player.id === playerId;
                const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : (index + 1);
                
                return `
                    <div class="ranking-item ${rankClass} ${isMe ? 'my-rank' : ''}">
                        <div class="rank-badge">${medal}</div>
                        <div class="rank-info">
                            <div class="rank-name">${player.name}${isMe ? ' (ë‚˜)' : ''}</div>
                            <div class="rank-stats">ì •ë‹µ ${player.correctCount || 0}ê°œ</div>
                        </div>
                        <div class="rank-score">${player.score || 0}ì </div>
                    </div>
                `;
            }).join('');
            
            // ë‚´ê°€ 10ìœ„ ë°–ì´ë©´ ë‚´ ìˆœìœ„ë„ í‘œì‹œ
            const myRankIndex = ranking.findIndex(p => p.id === playerId);
            if (myRankIndex >= 10) {
                const myPlayer = ranking[myRankIndex];
                container.innerHTML += `
                    <div style="text-align: center; margin: 12px 0; color: rgba(255,255,255,0.5);">...</div>
                    <div class="ranking-item my-rank">
                        <div class="rank-badge">${myRankIndex + 1}</div>
                        <div class="rank-info">
                            <div class="rank-name">${myPlayer.name} (ë‚˜)</div>
                            <div class="rank-stats">ì •ë‹µ ${myPlayer.correctCount || 0}ê°œ</div>
                        </div>
                        <div class="rank-score">${myPlayer.score || 0}ì </div>
                    </div>
                `;
            }
        }
        
        // ========================================
        // ìµœì¢… ê²°ê³¼
        // ========================================
        async function showFinalResult() {
            clearInterval(timerInterval);
            
            const playersSnapshot = await database.ref('players').once('value');
            const players = playersSnapshot.val() || {};
            
            const ranking = Object.entries(players)
                .map(([id, data]) => ({ id, ...data }))
                .sort((a, b) => (b.score || 0) - (a.score || 0));
            
            const myRankIndex = ranking.findIndex(p => p.id === playerId);
            const myPlayer = ranking[myRankIndex] || { score: 0, correctCount: 0, totalTime: 0 };
            
            document.getElementById('final-score').textContent = myPlayer.score || 0;
            document.getElementById('final-rank').textContent = `#${myRankIndex + 1}`;
            document.getElementById('final-correct').textContent = `${myPlayer.correctCount || 0}/${quizzes.length}`;
            
            const avgTime = myPlayer.correctCount > 0 
                ? ((myPlayer.totalTime || 0) / myPlayer.correctCount).toFixed(1) 
                : '-';
            document.getElementById('final-avg-time').textContent = avgTime + 'ì´ˆ';
            
            // ì „ì²´ ë­í‚¹ í‘œì‹œ
            await renderCurrentRanking('final-ranking-list');
        }
        
        // ========================================
        // ì „ì²´ ë­í‚¹ ë³´ê¸°
        // ========================================
        async function showRanking() {
            showScreen('ranking-screen');
            
            const playersSnapshot = await database.ref('players').once('value');
            const players = playersSnapshot.val() || {};
            
            const ranking = Object.entries(players)
                .map(([id, data]) => ({ id, ...data }))
                .sort((a, b) => (b.score || 0) - (a.score || 0));
            
            const container = document.getElementById('full-ranking-list');
            
            if (ranking.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.6); padding: 40px;">ì•„ì§ ì°¸ì—¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            container.innerHTML = ranking.map((player, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                const isMe = player.id === playerId;
                const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : (index + 1);
                
                return `
                    <div class="ranking-item ${rankClass} ${isMe ? 'my-rank' : ''}">
                        <div class="rank-badge">${medal}</div>
                        <div class="rank-info">
                            <div class="rank-name">${player.name}${isMe ? ' (ë‚˜)' : ''}</div>
                            <div class="rank-stats">ì •ë‹µ ${player.correctCount || 0}ê°œ</div>
                        </div>
                        <div class="rank-score">${player.score || 0}ì </div>
                    </div>
                `;
            }).join('');
        }
        
        // ========================================
        // ê´€ë¦¬ì ê¸°ëŠ¥
        // ========================================
        function showAdminLogin() {
            showScreen('admin-login-screen');
        }
        
        function loginAdmin() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('admin-badge').classList.remove('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('admin-login-btn').classList.add('hidden');
                document.getElementById('admin-password').value = '';
                showEntry();
                updateAdminPanel();
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }
        
        function logoutAdmin() {
            isAdmin = false;
            document.getElementById('admin-badge').classList.add('hidden');
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('admin-login-btn').classList.remove('hidden');
        }
        
        document.getElementById('admin-password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginAdmin();
        });
        
        document.getElementById('time-slider').addEventListener('input', function() {
            timeLimit = parseInt(this.value);
            document.getElementById('time-display').textContent = timeLimit;
        });
        
        // ë‹¤ìŒ ë¬¸ì œ ì‹œì‘
        async function adminStartQuestion() {
            const nextQuestion = gameState.currentQuestion + 1;
            
            if (nextQuestion >= quizzes.length) {
                alert('ëª¨ë“  ë¬¸ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const currentTimeLimit = parseInt(document.getElementById('time-slider').value);
            
            try {
                await database.ref('gameState').set({
                    status: 'playing',
                    currentQuestion: nextQuestion,
                    timeLimit: currentTimeLimit,
                    questionStartTime: Date.now()
                });
            } catch (error) {
                console.error('ë¬¸ì œ ì‹œì‘ ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì •ë‹µ ê³µê°œ
        async function adminShowAnswer() {
            try {
                // ì ìˆ˜ ê³„ì‚°
                await calculateScores();
                
                await database.ref('gameState').update({
                    status: 'showingAnswer'
                });
            } catch (error) {
                console.error('ì •ë‹µ ê³µê°œ ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì ìˆ˜ ê³„ì‚°
        async function calculateScores() {
            const qIndex = gameState.currentQuestion;
            const quiz = quizzes[qIndex];
            const correctAnswer = quiz.answer;
            
            const answersSnapshot = await database.ref(`answers/q${qIndex}`).once('value');
            const answers = answersSnapshot.val() || {};
            
            const updates = {};
            
            for (const [pid, answerData] of Object.entries(answers)) {
                if (answerData.answer === correctAnswer) {
                    const responseTime = answerData.responseTime || gameState.timeLimit;
                    const timeBonus = Math.max(0, Math.floor((gameState.timeLimit - responseTime) * 10));
                    const points = 100 + timeBonus;
                    
                    // í”Œë ˆì´ì–´ ì ìˆ˜ ì—…ë°ì´íŠ¸
                    const playerSnapshot = await database.ref(`players/${pid}`).once('value');
                    const playerData = playerSnapshot.val() || {};
                    
                    updates[`players/${pid}/score`] = (playerData.score || 0) + points;
                    updates[`players/${pid}/correctCount`] = (playerData.correctCount || 0) + 1;
                    updates[`players/${pid}/totalTime`] = (playerData.totalTime || 0) + responseTime;
                }
            }
            
            if (Object.keys(updates).length > 0) {
                await database.ref().update(updates);
            }
        }
        
        // í€´ì¦ˆ ì¢…ë£Œ
        async function adminEndGame() {
            if (!confirm('í€´ì¦ˆë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await database.ref('gameState').update({
                    status: 'finished'
                });
            } catch (error) {
                console.error('ì¢…ë£Œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì „ì²´ ì´ˆê¸°í™”
        async function resetAllData() {
            if (!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì°¸ì—¬ì, ì ìˆ˜, ë‹µë³€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤)')) return;
            
            try {
                await database.ref('gameState').set({
                    status: 'waiting',
                    currentQuestion: -1,
                    timeLimit: 15,
                    questionStartTime: null
                });
                await database.ref('players').remove();
                await database.ref('answers').remove();
                
                // ë¡œì»¬ ìƒíƒœ ì´ˆê¸°í™”
                playerId = null;
                myData = { score: 0, correctCount: 0, totalTime: 0, answeredQuestions: [] };
                
                alert('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ========================================
        // í€´ì¦ˆ í¸ì§‘
        // ========================================
        function showQuizEditor() {
            renderQuizEditor();
            showScreen('quiz-editor-screen');
        }
        
        function renderQuizEditor() {
            const container = document.getElementById('quiz-editor-list');
            
            container.innerHTML = quizzes.map((quiz, index) => `
                <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <strong style="color: #a78bfa;">ë¬¸ì œ ${index + 1}</strong>
                        <button onclick="removeQuiz(${index})" style="background: rgba(239,68,68,0.3); border: none; color: #fca5a5; padding: 4px 12px; border-radius: 6px; cursor: pointer;">ì‚­ì œ</button>
                    </div>
                    <textarea style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white; min-height: 60px; margin-bottom: 8px;" 
                        onchange="updateQuiz(${index}, 'question', this.value)">${quiz.question}</textarea>
                    <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                        <button onclick="setAnswer(${index}, true)" style="flex: 1; padding: 8px; border: 2px solid ${quiz.answer ? '#4ade80' : 'rgba(255,255,255,0.3)'}; border-radius: 8px; background: ${quiz.answer ? 'rgba(34,197,94,0.3)' : 'transparent'}; color: ${quiz.answer ? '#4ade80' : 'white'}; cursor: pointer; font-weight: bold;">O (ì°¸)</button>
                        <button onclick="setAnswer(${index}, false)" style="flex: 1; padding: 8px; border: 2px solid ${!quiz.answer ? '#f87171' : 'rgba(255,255,255,0.3)'}; border-radius: 8px; background: ${!quiz.answer ? 'rgba(239,68,68,0.3)' : 'transparent'}; color: ${!quiz.answer ? '#f87171' : 'white'}; cursor: pointer; font-weight: bold;">X (ê±°ì§“)</button>
                    </div>
                    <input type="text" placeholder="í•´ì„¤" value="${quiz.explanation}" onchange="updateQuiz(${index}, 'explanation', this.value)"
                        style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); color: white;">
                </div>
            `).join('');
        }
        
        function updateQuiz(index, field, value) {
            quizzes[index][field] = value;
        }
        
        function setAnswer(index, value) {
            quizzes[index].answer = value;
            renderQuizEditor();
        }
        
        function addNewQuiz() {
            quizzes.push({
                id: Date.now(),
                question: "",
                answer: true,
                explanation: ""
            });
            renderQuizEditor();
        }
        
        function removeQuiz(index) {
            if (quizzes.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ë¬¸ì œê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            if (confirm(`ë¬¸ì œ ${index + 1}ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                quizzes.splice(index, 1);
                renderQuizEditor();
            }
        }
        
        async function saveQuizzes() {
            const emptyQuiz = quizzes.find(q => !q.question.trim());
            if (emptyQuiz) {
                alert('ë¬¸ì œ ë‚´ìš©ì´ ë¹„ì–´ìˆëŠ” í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                await database.ref('quizzes').set(quizzes);
                alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                showEntry();
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ========================================
        // QR ì½”ë“œ
        // ========================================
        function generateQR() {
            const url = window.location.href;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
            document.getElementById('qr-image').src = qrUrl;
        }
        
        // ========================================
        // ì´ˆê¸°í™”
        // ========================================
        initFirebase();
        
        // Enter í‚¤ë¡œ ì°¸ì—¬
        document.getElementById('player-name').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') joinQuiz();
        });
    </script>
</body>
</html>
